{"ast":null,"code":"import React,{useCallback,useContext,useEffect,useState}from\"react\";import{toast}from\"react-toastify\";import api from\"../../services/api\";import toastError from\"../../errors/toastError\";import{Box,Button,Dialog,DialogActions,makeStyles}from\"@material-ui/core\";import{useHistory}from\"react-router-dom\";import{AuthContext}from\"../../context/Auth/AuthContext\";import MessagesList from\"../MessagesList\";import{ReplyMessageProvider}from\"../../context/ReplyingMessage/ReplyingMessageContext\";import{ForwardMessageProvider}from\"../../context/ForwarMessage/ForwardMessageContext\";import TicketHeader from\"../TicketHeader\";import TicketInfo from\"../TicketInfo\";import html2pdf from\"html2pdf.js\";const drawerWidth=320;const useStyles=makeStyles(theme=>({root:{display:\"flex\",height:\"100%\",position:\"relative\",overflow:\"hidden\"},mainWrapper:{flex:1,height:\"100%\",display:\"flex\",flexDirection:\"column\",overflow:\"hidden\",borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:\"0\",marginRight:-drawerWidth,transition:theme.transitions.create(\"margin\",{easing:theme.transitions.easing.sharp,duration:theme.transitions.duration.leavingScreen})},mainWrapperShift:{borderTopRightRadius:0,borderBottomRightRadius:0,transition:theme.transitions.create(\"margin\",{easing:theme.transitions.easing.easeOut,duration:theme.transitions.duration.enteringScreen}),marginRight:0}}));export default function TicketMessagesDialog(_ref){let{open,handleClose,ticketId}=_ref;const history=useHistory();const classes=useStyles();const{user,socket}=useContext(AuthContext);const[,setDrawerOpen]=useState(false);const[loading,setLoading]=useState(true);const[contact,setContact]=useState({});const[ticket,setTicket]=useState({});const[exportedToPDF,setExportedToPDF]=useState(false);const handleExportToPDF=()=>{const messagesListElement=document.getElementById(\"messagesList\");// Id do elemento que você deseja exportar para PDF\nconst headerElement=document.getElementById(\"TicketHeader\");// Id do elemento de cabeçalho que você deseja exportar\nconst pdfOPtions={margin:1,filename:\"relat\\xF3rio_atendimento_\".concat(ticketId,\".pdf\"),image:{type:'jpeg',quality:0.98},html2canvas:{scale:2},jsPDF:{unit:'mm',format:'a4',orientation:'portrait'}};if(messagesListElement){const headerClone=headerElement.cloneNode(true);const messagesListClone=messagesListElement.cloneNode(true);const containerElement=document.createElement(\"div\");containerElement.appendChild(headerClone);// Adicione o elemento do cabeçalho\ncontainerElement.appendChild(messagesListClone);html2pdf().from(containerElement).set(pdfOPtions).save();}else{toastError(\"Elemento não encontrado para exportar.\");}};const handleExportAndClose=()=>{if(!exportedToPDF){handleExportToPDF();setExportedToPDF(true);handleClose();// Fecha o Dialog\n}};useEffect(()=>{if(open){// Execute a exportação para PDF e feche o Dialog\nhandleExportAndClose();}},[open,ticketId,handleExportAndClose]);return/*#__PURE__*/React.createElement(Dialog,{maxWidth:\"md\",onClose:handleClose,open:open},/*#__PURE__*/React.createElement(DialogActions,null,/*#__PURE__*/React.createElement(Button,{onClick:handleExportToPDF,color:\"primary\"},\"Exportar para PDF\"),/*#__PURE__*/React.createElement(Button,{onClick:handleClose,color:\"primary\"},\"Fechar\")));}","map":{"version":3,"names":["React","useCallback","useContext","useEffect","useState","toast","api","toastError","Box","Button","Dialog","DialogActions","makeStyles","useHistory","AuthContext","MessagesList","ReplyMessageProvider","ForwardMessageProvider","TicketHeader","TicketInfo","html2pdf","drawerWidth","useStyles","theme","root","display","height","position","overflow","mainWrapper","flex","flexDirection","borderTopLeftRadius","borderBottomLeftRadius","borderLeft","marginRight","transition","transitions","create","easing","sharp","duration","leavingScreen","mainWrapperShift","borderTopRightRadius","borderBottomRightRadius","easeOut","enteringScreen","TicketMessagesDialog","_ref","open","handleClose","ticketId","history","classes","user","socket","setDrawerOpen","loading","setLoading","contact","setContact","ticket","setTicket","exportedToPDF","setExportedToPDF","handleExportToPDF","messagesListElement","document","getElementById","headerElement","pdfOPtions","margin","filename","concat","image","type","quality","html2canvas","scale","jsPDF","unit","format","orientation","headerClone","cloneNode","messagesListClone","containerElement","createElement","appendChild","from","set","save","handleExportAndClose","maxWidth","onClose","onClick","color"],"sources":["C:/ProjectsCode/ZapRun/ZapRun/frontend/src/components/TicketMessagesDialog/index.js"],"sourcesContent":["import React, { useCallback, useContext, useEffect, useState } from \"react\";\r\n\r\nimport { toast } from \"react-toastify\";\r\nimport api from \"../../services/api\";\r\nimport toastError from \"../../errors/toastError\";\r\n\r\nimport {\r\n  Box,\r\n  Button,\r\n  Dialog,\r\n  DialogActions,\r\n  makeStyles,\r\n} from \"@material-ui/core\";\r\nimport { useHistory } from \"react-router-dom\";\r\nimport { AuthContext } from \"../../context/Auth/AuthContext\";\r\nimport MessagesList from \"../MessagesList\";\r\nimport { ReplyMessageProvider } from \"../../context/ReplyingMessage/ReplyingMessageContext\";\r\nimport { ForwardMessageProvider } from \"../../context/ForwarMessage/ForwardMessageContext\";\r\n\r\nimport TicketHeader from \"../TicketHeader\";\r\nimport TicketInfo from \"../TicketInfo\";\r\n\r\nimport html2pdf from \"html2pdf.js\";\r\n\r\nconst drawerWidth = 320;\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  root: {\r\n    display: \"flex\",\r\n    height: \"100%\",\r\n    position: \"relative\",\r\n    overflow: \"hidden\",\r\n  },\r\n\r\n  mainWrapper: {\r\n    flex: 1,\r\n    height: \"100%\",\r\n    display: \"flex\",\r\n    flexDirection: \"column\",\r\n    overflow: \"hidden\",\r\n    borderTopLeftRadius: 0,\r\n    borderBottomLeftRadius: 0,\r\n    borderLeft: \"0\",\r\n    marginRight: -drawerWidth,\r\n    transition: theme.transitions.create(\"margin\", {\r\n      easing: theme.transitions.easing.sharp,\r\n      duration: theme.transitions.duration.leavingScreen,\r\n    }),\r\n  },\r\n\r\n  mainWrapperShift: {\r\n    borderTopRightRadius: 0,\r\n    borderBottomRightRadius: 0,\r\n    transition: theme.transitions.create(\"margin\", {\r\n      easing: theme.transitions.easing.easeOut,\r\n      duration: theme.transitions.duration.enteringScreen,\r\n    }),\r\n    marginRight: 0,\r\n  },\r\n}));\r\n\r\nexport default function TicketMessagesDialog({ open, handleClose, ticketId }) {\r\n  const history = useHistory();\r\n  const classes = useStyles();\r\n\r\n  const { user, socket } = useContext(AuthContext);\r\n\r\n  const [, setDrawerOpen] = useState(false);\r\n  const [loading, setLoading] = useState(true);\r\n  const [contact, setContact] = useState({});\r\n  const [ticket, setTicket] = useState({});\r\n\r\n  const [exportedToPDF, setExportedToPDF] = useState(false);\r\n\r\n  \r\n  const handleExportToPDF = () => {\r\n    const messagesListElement = document.getElementById(\"messagesList\"); // Id do elemento que você deseja exportar para PDF\r\n    const headerElement = document.getElementById(\"TicketHeader\"); // Id do elemento de cabeçalho que você deseja exportar\r\n\r\n\r\n    const pdfOPtions = {\r\n      margin: 1,\r\n      filename: `relatório_atendimento_${ticketId}.pdf`,\r\n      image: { type: 'jpeg', quality: 0.98 },\r\n      html2canvas: { scale: 2 },\r\n      jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }\r\n    };\r\n\r\n    if (messagesListElement) {\r\n      const headerClone = headerElement.cloneNode(true);\r\n      const messagesListClone = messagesListElement.cloneNode(true);\r\n\r\n      const containerElement = document.createElement(\"div\");\r\n      containerElement.appendChild(headerClone); // Adicione o elemento do cabeçalho\r\n      containerElement.appendChild(messagesListClone);\r\n      html2pdf()\r\n        .from(containerElement)\r\n        .set(pdfOPtions)\r\n        .save();\r\n    } else {\r\n      toastError(\"Elemento não encontrado para exportar.\");\r\n    }\r\n  };\r\n\r\n  const handleExportAndClose = () => {\r\n    if (!exportedToPDF) {\r\n      handleExportToPDF();\r\n      setExportedToPDF(true);\r\n      handleClose(); // Fecha o Dialog\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (open) {\r\n      // Execute a exportação para PDF e feche o Dialog\r\n      handleExportAndClose();\r\n    }\r\n  }, [open, ticketId, handleExportAndClose]);\r\n\r\n\r\n  return (\r\n    <Dialog maxWidth=\"md\" onClose={handleClose} open={open}>\r\n      <DialogActions>\r\n        <Button onClick={handleExportToPDF} color=\"primary\">\r\n          Exportar para PDF\r\n        </Button>\r\n        <Button onClick={handleClose} color=\"primary\">\r\n          Fechar\r\n        </Button>\r\n      </DialogActions>\r\n    </Dialog>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}