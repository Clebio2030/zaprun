{"ast":null,"code":"import React,{useState,useEffect}from\"react\";import{makeStyles}from\"@material-ui/core/styles\";import Typography from\"@material-ui/core/Typography\";import Paper from\"@material-ui/core/Paper\";import TextField from\"@material-ui/core/TextField\";import Button from\"@material-ui/core/Button\";import FormControl from\"@material-ui/core/FormControl\";import InputLabel from\"@material-ui/core/InputLabel\";import Select from\"@material-ui/core/Select\";import MenuItem from\"@material-ui/core/MenuItem\";import FormHelperText from\"@material-ui/core/FormHelperText\";import Grid from\"@material-ui/core/Grid\";import CircularProgress from\"@material-ui/core/CircularProgress\";import api from\"../../services/api\";import{toast}from\"react-toastify\";import{i18n}from\"../../translate/i18n\";const useStyles=makeStyles(theme=>({root:{display:\"flex\",flexDirection:\"column\"},paper:{padding:theme.spacing(2),display:\"flex\",flexDirection:\"column\"},formControl:{margin:theme.spacing(1),minWidth:120},textField:{margin:theme.spacing(1)},mediaPreview:{margin:theme.spacing(1),maxWidth:\"100%\",maxHeight:400,objectFit:\"contain\",borderRadius:\"8px\"},buttonProgress:{position:'absolute',top:'50%',left:'50%',marginTop:-12,marginLeft:-12},buttonWrapper:{margin:theme.spacing(1),position:'relative'},errorText:{color:theme.palette.error.main,margin:theme.spacing(1)},helpText:{color:theme.palette.text.secondary,margin:theme.spacing(1),fontSize:\"0.9rem\"},youtubeContainer:{position:'relative',width:'100%',paddingTop:'56.25%',// Proporção 16:9\nmaxWidth:'600px',borderRadius:'8px',overflow:'hidden'},youtubeIframe:{position:'absolute',top:0,left:0,width:'100%',height:'100%',border:'none'}}));const WelcomeMedia=()=>{const classes=useStyles();const[loading,setLoading]=useState(false);const[loadingFetch,setLoadingFetch]=useState(true);const[mediaType,setMediaType]=useState(\"image\");const[mediaUrl,setMediaUrl]=useState(\"\");const[mediaWidth,setMediaWidth]=useState(\"50%\");const[error,setError]=useState(\"\");const[debugInfo,setDebugInfo]=useState(\"\");useEffect(()=>{const fetchMediaConfig=async()=>{setLoadingFetch(true);try{const{data}=await api.get(\"/settings/welcome-media\");if(data){setMediaType(data.type||\"image\");setMediaUrl(data.url||\"\");setMediaWidth(data.width||\"50%\");}}catch(error){console.error(\"Erro ao buscar configurações de mídia:\",error);toast.error(\"Erro ao carregar configurações de mídia\");setError(\"Não foi possível carregar as configurações. Tente novamente mais tarde.\");}finally{setLoadingFetch(false);}};fetchMediaConfig();},[]);const validateURL=urlString=>{try{new URL(urlString);return true;}catch(e){return false;}};const validateForm=()=>{setError(\"\");if(!mediaUrl){setError(\"A URL da mídia é obrigatória\");return false;}if(mediaType!==\"youtube\"&&!validateURL(mediaUrl)){setError(\"Por favor, insira uma URL válida\");return false;}if(!mediaWidth){setMediaWidth(\"50%\");}return true;};const handleSubmit=async e=>{e.preventDefault();setError(\"\");setDebugInfo(\"\");if(!validateForm()){return;}setLoading(true);// Criar payload com os dados da mídia\nconst payload={type:mediaType,url:mediaUrl.trim(),width:mediaWidth.trim()};try{const response=await api.put(\"/settings/welcome-media\",payload);console.log(\"Resposta do servidor:\",response.data);toast.success(\"Configurações salvas com sucesso!\");}catch(error){var _error$response,_error$response$data,_error$response2;console.error(\"Erro detalhado:\",error);const errorMessage=((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.error)||\"Erro ao salvar configurações\";setDebugInfo(\"Status: \".concat((_error$response2=error.response)===null||_error$response2===void 0?void 0:_error$response2.status,\"\\nMensagem: \").concat(errorMessage,\"\\nTipo de m\\xEDdia: \").concat(mediaType,\"\\nURL: \").concat(mediaUrl,\"\\nLargura: \").concat(mediaWidth));toast.error(errorMessage);setError(errorMessage);}finally{setLoading(false);}};const renderMediaPreview=()=>{if(!mediaUrl)return null;if(mediaType===\"youtube\"){// Extrair ID do vídeo do YouTube a partir da URL\nconst getYoutubeVideoId=url=>{// Tenta diferentes formatos de URL do YouTube\nconst regExp=/^.*(youtu.be\\/|v\\/|u\\/\\w\\/|embed\\/|watch\\?v=|&v=)([^#&?]*).*/;const match=url.match(regExp);return match&&match[2].length===11?match[2]:null;};const videoId=getYoutubeVideoId(mediaUrl);if(!videoId)return/*#__PURE__*/React.createElement(\"div\",null,\"URL do YouTube inv\\xE1lida\");return/*#__PURE__*/React.createElement(\"div\",{className:classes.youtubeContainer,style:{width:mediaWidth}},/*#__PURE__*/React.createElement(\"iframe\",{className:classes.youtubeIframe,src:\"https://www.youtube.com/embed/\".concat(videoId),title:\"YouTube video player\",frameBorder:\"0\",allow:\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\",allowFullScreen:true}));}else if(mediaType===\"video\"){return/*#__PURE__*/React.createElement(\"video\",{src:mediaUrl,className:classes.mediaPreview,controls:true,width:mediaWidth});}else{return/*#__PURE__*/React.createElement(\"img\",{src:\"\".concat(mediaUrl,\"?v=\").concat(Date.now()),alt:\"Pr\\xE9via da m\\xEDdia\",className:classes.mediaPreview,style:{width:mediaWidth},onError:e=>{e.target.onerror=null;e.target.src=\"https://via.placeholder.com/400x300?text=Imagem+não+encontrada\";setError(\"Não foi possível carregar a imagem. Verifique a URL.\");}});}};const sugestaoImagens=()=>{return/*#__PURE__*/React.createElement(\"div\",{className:classes.helpText},/*#__PURE__*/React.createElement(\"p\",null,/*#__PURE__*/React.createElement(\"strong\",null,\"Sugest\\xF5es de imagens:\")),/*#__PURE__*/React.createElement(\"ul\",null,/*#__PURE__*/React.createElement(\"li\",null,\"https://i.imgur.com/ZCODluy.png (imagem padr\\xE3o)\"),/*#__PURE__*/React.createElement(\"li\",null,\"https://images.unsplash.com/photo-1503844281047-cf42eade5ca5 (exemplo)\"),/*#__PURE__*/React.createElement(\"li\",null,\"https://images.pexels.com/photos/163036/mario-luigi-yoschi-figures-163036.jpeg (exemplo)\")));};if(loadingFetch){return/*#__PURE__*/React.createElement(\"div\",{className:classes.root,style:{alignItems:'center',justifyContent:'center',minHeight:'200px'}},/*#__PURE__*/React.createElement(CircularProgress,null),/*#__PURE__*/React.createElement(Typography,{variant:\"body2\",style:{marginTop:16}},\"Carregando configura\\xE7\\xF5es...\"));}return/*#__PURE__*/React.createElement(\"div\",{className:classes.root},/*#__PURE__*/React.createElement(Paper,{className:classes.paper},/*#__PURE__*/React.createElement(Typography,{variant:\"h6\"},\"Configura\\xE7\\xF5es de M\\xEDdia de Boas-vindas\"),error&&/*#__PURE__*/React.createElement(Typography,{variant:\"body2\",className:classes.errorText},error),/*#__PURE__*/React.createElement(\"form\",{onSubmit:handleSubmit},/*#__PURE__*/React.createElement(Grid,{container:true,spacing:2},/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,md:6},/*#__PURE__*/React.createElement(FormControl,{variant:\"outlined\",fullWidth:true,className:classes.formControl},/*#__PURE__*/React.createElement(InputLabel,null,\"Tipo de M\\xEDdia\"),/*#__PURE__*/React.createElement(Select,{value:mediaType,onChange:e=>setMediaType(e.target.value),label:\"Tipo de M\\xEDdia\",disabled:loading},/*#__PURE__*/React.createElement(MenuItem,{value:\"image\"},\"Imagem\"),/*#__PURE__*/React.createElement(MenuItem,{value:\"video\"},\"V\\xEDdeo\"),/*#__PURE__*/React.createElement(MenuItem,{value:\"youtube\"},\"YouTube\")),/*#__PURE__*/React.createElement(FormHelperText,null,mediaType===\"youtube\"?\"Insira uma URL do YouTube (ex: https://www.youtube.com/watch?v=ID ou https://youtu.be/ID)\":mediaType===\"video\"?\"Insira um link direto para um arquivo de vídeo MP4, WebM ou Ogg\":\"Selecione o tipo de mídia que será exibida\")),/*#__PURE__*/React.createElement(TextField,{label:\"URL da M\\xEDdia\",variant:\"outlined\",value:mediaUrl,onChange:e=>setMediaUrl(e.target.value),fullWidth:true,required:true,className:classes.textField,helperText:\"Informe a URL completa da imagem ou v\\xEDdeo\",error:!mediaUrl&&error,disabled:loading}),/*#__PURE__*/React.createElement(TextField,{label:\"Largura da M\\xEDdia\",variant:\"outlined\",value:mediaWidth,onChange:e=>setMediaWidth(e.target.value),fullWidth:true,className:classes.textField,helperText:\"Exemplo: 50%, 300px, 100%, etc.\",disabled:loading}),/*#__PURE__*/React.createElement(\"div\",{className:classes.buttonWrapper},/*#__PURE__*/React.createElement(Button,{type:\"submit\",color:\"primary\",variant:\"contained\",disabled:loading},loading?\"Salvando...\":\"Salvar\"),loading&&/*#__PURE__*/React.createElement(CircularProgress,{size:24,className:classes.buttonProgress})),mediaType===\"image\"&&sugestaoImagens()),/*#__PURE__*/React.createElement(Grid,{item:true,xs:12,md:6},/*#__PURE__*/React.createElement(Typography,{variant:\"subtitle1\"},\"Pr\\xE9via:\"),renderMediaPreview(),debugInfo&&/*#__PURE__*/React.createElement(\"div\",{className:classes.helpText,style:{marginTop:'20px'}},/*#__PURE__*/React.createElement(Typography,{variant:\"subtitle2\"},\"Informa\\xE7\\xF5es de Debug:\"),/*#__PURE__*/React.createElement(\"pre\",{style:{whiteSpace:'pre-wrap',fontSize:'0.8rem'}},debugInfo)))))));};export default WelcomeMedia;","map":null,"metadata":{},"sourceType":"module"}