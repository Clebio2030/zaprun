{"ast":null,"code":"import React,{useContext,useState}from\"react\";import{Chip,IconButton,List,ListItem,ListItemSecondaryAction,ListItemText,makeStyles}from\"@material-ui/core\";import{useHistory,useParams}from\"react-router-dom\";import{AuthContext}from\"../../context/Auth/AuthContext\";import{useDate}from\"../../hooks/useDate\";import DeleteIcon from\"@material-ui/icons/Delete\";import EditIcon from\"@material-ui/icons/Edit\";import ConfirmationModal from\"../../components/ConfirmationModal\";import api from\"../../services/api\";const useStyles=makeStyles(theme=>({mainContainer:{display:\"flex\",flexDirection:\"column\",position:\"relative\",flex:1,height:\"calc(100% - 58px)\",overflow:\"hidden\",borderRadius:0,backgroundColor:theme.mode==='light'?\"#f2f2f2\":\"#7f7f7f\"},chatList:{display:\"flex\",flexDirection:\"column\",position:\"relative\",flex:1,overflowY:\"scroll\",...theme.scrollbarStyles},listItemActive:{cursor:\"pointer\",backgroundColor:theme.palette.background.paper,borderLeft:\"6px solid #002d6e\"},listItem:{cursor:\"pointer\",backgroundColor:theme.palette.background.color}}));export default function ChatList(_ref){let{chats,handleSelectChat,handleDeleteChat,handleEditChat,pageInfo,loading}=_ref;const classes=useStyles();const history=useHistory();const{user,socket}=useContext(AuthContext);const{datetimeToClient}=useDate();const[confirmationModal,setConfirmModalOpen]=useState(false);const[selectedChat,setSelectedChat]=useState({});const{id}=useParams();const goToMessages=async chat=>{if(unreadMessages(chat)>0){try{await api.post(\"/chats/\".concat(chat.id,\"/read\"),{userId:user.id});}catch(err){}}if(id!==chat.uuid){history.push(\"/chats/\".concat(chat.uuid));handleSelectChat(chat);}};const handleDelete=()=>{handleDeleteChat(selectedChat);};const unreadMessages=chat=>{const currentUser=chat.users.find(u=>u.userId===user.id);return currentUser.unreads;};const getPrimaryText=chat=>{const mainText=chat.title;const unreads=unreadMessages(chat);return/*#__PURE__*/React.createElement(React.Fragment,null,mainText,unreads>0&&/*#__PURE__*/React.createElement(Chip,{size:\"small\",style:{marginLeft:5},label:unreads,color:\"secondary\"}));};const getSecondaryText=chat=>{return chat.lastMessage!==\"\"?\"\".concat(datetimeToClient(chat.updatedAt),\": \").concat(chat.lastMessage):\"\";};return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(ConfirmationModal,{title:\"Excluir Conversa\",open:confirmationModal,onClose:setConfirmModalOpen,onConfirm:handleDelete},\"Esta a\\xE7\\xE3o n\\xE3o pode ser revertida, confirmar?\"),/*#__PURE__*/React.createElement(\"div\",{className:classes.mainContainer},/*#__PURE__*/React.createElement(\"div\",{className:classes.chatList},/*#__PURE__*/React.createElement(List,null,Array.isArray(chats)&&chats.length>0&&chats.map((chat,key)=>/*#__PURE__*/React.createElement(ListItem,{onClick:()=>goToMessages(chat),key:key,className:chat.uuid===id?classes.listItemActive:classes.listItem// style={getItemStyle(chat)}\n,button:true},/*#__PURE__*/React.createElement(ListItemText,{primary:getPrimaryText(chat),secondary:getSecondaryText(chat)}),chat.ownerId===user.id&&/*#__PURE__*/React.createElement(ListItemSecondaryAction,null,/*#__PURE__*/React.createElement(IconButton,{onClick:()=>{goToMessages(chat).then(()=>{handleEditChat(chat);});},edge:\"end\",\"aria-label\":\"delete\",size:\"small\",style:{marginRight:5}},/*#__PURE__*/React.createElement(EditIcon,null)),/*#__PURE__*/React.createElement(IconButton,{onClick:()=>{setSelectedChat(chat);setConfirmModalOpen(true);},edge:\"end\",\"aria-label\":\"delete\",size:\"small\"},/*#__PURE__*/React.createElement(DeleteIcon,null)))))))));}","map":{"version":3,"names":["React","useContext","useState","Chip","IconButton","List","ListItem","ListItemSecondaryAction","ListItemText","makeStyles","useHistory","useParams","AuthContext","useDate","DeleteIcon","EditIcon","ConfirmationModal","api","useStyles","theme","mainContainer","display","flexDirection","position","flex","height","overflow","borderRadius","backgroundColor","mode","chatList","overflowY","scrollbarStyles","listItemActive","cursor","palette","background","paper","borderLeft","listItem","color","ChatList","_ref","chats","handleSelectChat","handleDeleteChat","handleEditChat","pageInfo","loading","classes","history","user","socket","datetimeToClient","confirmationModal","setConfirmModalOpen","selectedChat","setSelectedChat","id","goToMessages","chat","unreadMessages","post","concat","userId","err","uuid","push","handleDelete","currentUser","users","find","u","unreads","getPrimaryText","mainText","title","createElement","Fragment","size","style","marginLeft","label","getSecondaryText","lastMessage","updatedAt","open","onClose","onConfirm","className","Array","isArray","length","map","key","onClick","button","primary","secondary","ownerId","then","edge","marginRight"],"sources":["C:/ProjectsCode/ZapRun/ZapRun/frontend/src/pages/Chat/ChatList.js"],"sourcesContent":["import React, { useContext, useState } from \"react\";\nimport {\n  Chip,\n  IconButton,\n  List,\n  ListItem,\n  ListItemSecondaryAction,\n  ListItemText,\n  makeStyles,\n} from \"@material-ui/core\";\n\nimport { useHistory, useParams } from \"react-router-dom\";\nimport { AuthContext } from \"../../context/Auth/AuthContext\";\nimport { useDate } from \"../../hooks/useDate\";\n\nimport DeleteIcon from \"@material-ui/icons/Delete\";\nimport EditIcon from \"@material-ui/icons/Edit\";\n\nimport ConfirmationModal from \"../../components/ConfirmationModal\";\nimport api from \"../../services/api\";\n\nconst useStyles = makeStyles((theme) => ({\n  mainContainer: {\n    display: \"flex\",\n    flexDirection: \"column\",\n    position: \"relative\",\n    flex: 1,\n    height: \"calc(100% - 58px)\",\n    overflow: \"hidden\",\n    borderRadius: 0,\n    backgroundColor: theme.mode === 'light' ? \"#f2f2f2\" : \"#7f7f7f\",\n  },\n  chatList: {\n    display: \"flex\",\n    flexDirection: \"column\",\n    position: \"relative\",\n    flex: 1,\n    overflowY: \"scroll\",\n    ...theme.scrollbarStyles,\n  },\n  listItemActive: {\n    cursor: \"pointer\",\n    backgroundColor: theme.palette.background.paper,\n    borderLeft: \"6px solid #002d6e\",\n  },\n  listItem: {\n    cursor: \"pointer\",\n    backgroundColor: theme.palette.background.color,\n  },\n}));\n\nexport default function ChatList({\n  chats,\n  handleSelectChat,\n  handleDeleteChat,\n  handleEditChat,\n  pageInfo,\n  loading,\n}) {\n  const classes = useStyles();\n  const history = useHistory();\n  const { user, socket } = useContext(AuthContext);\n  const { datetimeToClient } = useDate();\n\n  const [confirmationModal, setConfirmModalOpen] = useState(false);\n  const [selectedChat, setSelectedChat] = useState({});\n\n  const { id } = useParams();\n\n  const goToMessages = async (chat) => {\n    if (unreadMessages(chat) > 0) {\n      try {\n        await api.post(`/chats/${chat.id}/read`, { userId: user.id });\n      } catch (err) {}\n    }\n\n    if (id !== chat.uuid) {\n      history.push(`/chats/${chat.uuid}`);\n      handleSelectChat(chat);\n    }\n  };\n\n  const handleDelete = () => {\n    handleDeleteChat(selectedChat);\n  };\n\n  const unreadMessages = (chat) => {\n    const currentUser = chat.users.find((u) => u.userId === user.id);\n    return currentUser.unreads;\n  };\n\n  const getPrimaryText = (chat) => {\n    const mainText = chat.title;\n    const unreads = unreadMessages(chat);\n    return (\n      <>\n        {mainText}\n        {unreads > 0 && (\n          <Chip\n            size=\"small\"\n            style={{ marginLeft: 5 }}\n            label={unreads}\n            color=\"secondary\"\n          />\n        )}\n      </>\n    );\n  };\n\n  const getSecondaryText = (chat) => {\n    return chat.lastMessage !== \"\"\n      ? `${datetimeToClient(chat.updatedAt)}: ${chat.lastMessage}`\n      : \"\";\n  };\n\n  return (\n    <>\n      <ConfirmationModal\n        title={\"Excluir Conversa\"}\n        open={confirmationModal}\n        onClose={setConfirmModalOpen}\n        onConfirm={handleDelete}\n      >\n        Esta ação não pode ser revertida, confirmar?\n      </ConfirmationModal>\n      <div className={classes.mainContainer}>\n        <div className={classes.chatList}>\n          <List>\n            {Array.isArray(chats) &&\n              chats.length > 0 &&\n              chats.map((chat, key) => (\n                <ListItem\n                  onClick={() => goToMessages(chat)}\n                  key={key}\n                  className={chat.uuid === id ? classes.listItemActive : classes.listItem}\n                  // style={getItemStyle(chat)}\n                  button\n                >\n                  <ListItemText\n                    primary={getPrimaryText(chat)}\n                    secondary={getSecondaryText(chat)}\n                  />\n                  {chat.ownerId === user.id && (\n                    <ListItemSecondaryAction>\n                      <IconButton\n                        onClick={() => {\n                          goToMessages(chat).then(() => {\n                            handleEditChat(chat);\n                          });\n                        }}\n                        edge=\"end\"\n                        aria-label=\"delete\"\n                        size=\"small\"\n                        style={{ marginRight: 5 }}\n                      >\n                        <EditIcon />\n                      </IconButton>\n                      <IconButton\n                        onClick={() => {\n                          setSelectedChat(chat);\n                          setConfirmModalOpen(true);\n                        }}\n                        edge=\"end\"\n                        aria-label=\"delete\"\n                        size=\"small\"\n                      >\n                        <DeleteIcon />\n                      </IconButton>\n                    </ListItemSecondaryAction>\n                  )}\n                </ListItem>\n              ))}\n          </List>\n        </div>\n      </div>\n    </>\n  );\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}