{"ast":null,"code":"import React,{useEffect,useState,useContext}from'react';import{useHistory}from\"react-router-dom\";import toastError from\"../../errors/toastError\";import api from\"../../services/api\";import Avatar from\"@material-ui/core/Avatar\";import Typography from\"@material-ui/core/Typography\";import Grid from\"@material-ui/core/Grid\";import{AuthContext}from\"../../context/Auth/AuthContext\";import{Button,Divider,useTheme}from\"@material-ui/core\";import{isNil}from'lodash';import ShowTicketOpen from'../ShowTicketOpenModal';import{grey}from'@material-ui/core/colors';const VcardPreview=_ref=>{let{contact,numbers,queueId,whatsappId}=_ref;const theme=useTheme();const history=useHistory();const{user}=useContext(AuthContext);const companyId=user.companyId;const[openAlert,setOpenAlert]=useState(false);const[userTicketOpen,setUserTicketOpen]=useState(\"\");const[queueTicketOpen,setQueueTicketOpen]=useState(\"\");const[selectedContact,setContact]=useState({id:0,name:\"\",number:0,profilePicUrl:\"\"});useEffect(()=>{const delayDebounceFn=setTimeout(()=>{const fetchContacts=async()=>{try{if(isNil(numbers)){return;}const number=numbers.replace(/\\D/g,\"\");const getData=await api.get(\"/contacts/profile/\".concat(number));if(getData.data.contactId&&getData.data.contactId!==0){let obj={id:getData.data.contactId,name:contact,number:numbers,profilePicUrl:getData.data.urlPicture};setContact(obj);}else{let contactObj={name:contact,number:number,email:\"\",companyId:companyId};const{data}=await api.post(\"/contacts\",contactObj);setContact(data);}}catch(err){console.log(err);toastError(err);}};fetchContacts();},500);return()=>clearTimeout(delayDebounceFn);},[companyId,contact,numbers]);const handleCloseAlert=()=>{setOpenAlert(false);setOpenAlert(false);setUserTicketOpen(\"\");setQueueTicketOpen(\"\");};const handleNewChat=async()=>{try{const{data:ticket}=await api.post(\"/tickets\",{contactId:selectedContact.id,userId:user.id,status:\"open\",queueId,companyId:companyId,whatsappId});history.push(\"/tickets/\".concat(ticket.uuid));}catch(err){const ticket=JSON.parse(err.response.data.error);if(ticket.userId!==(user===null||user===void 0?void 0:user.id)){setOpenAlert(true);setUserTicketOpen(ticket.user.name);setQueueTicketOpen(ticket.queue.name);}else{setOpenAlert(false);setUserTicketOpen(\"\");setQueueTicketOpen(\"\");history.push(\"/tickets/\".concat(ticket.uuid));}}};return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"div\",{style:{minWidth:\"250px\"}},/*#__PURE__*/React.createElement(ShowTicketOpen,{isOpen:openAlert,handleClose:handleCloseAlert,user:userTicketOpen,queue:queueTicketOpen}),/*#__PURE__*/React.createElement(Grid,{container:true,spacing:1},/*#__PURE__*/React.createElement(Grid,{item:true,xs:2},/*#__PURE__*/React.createElement(Avatar,{src:\"\".concat(selectedContact===null||selectedContact===void 0?void 0:selectedContact.urlPicture)})),/*#__PURE__*/React.createElement(Grid,{item:true,xs:9},/*#__PURE__*/React.createElement(Typography,{style:{marginTop:\"12px\",marginLeft:\"10px\"},color:\"primary\",variant:\"subtitle1\",gutterBottom:true},selectedContact.name)),/*#__PURE__*/React.createElement(Grid,{item:true,xs:12},/*#__PURE__*/React.createElement(Divider,null),/*#__PURE__*/React.createElement(Button,{fullWidth:true,color:\"primary\",onClick:handleNewChat,disabled:!selectedContact.number},\"Conversar\")))));};export default VcardPreview;","map":{"version":3,"names":["React","useEffect","useState","useContext","useHistory","toastError","api","Avatar","Typography","Grid","AuthContext","Button","Divider","useTheme","isNil","ShowTicketOpen","grey","VcardPreview","_ref","contact","numbers","queueId","whatsappId","theme","history","user","companyId","openAlert","setOpenAlert","userTicketOpen","setUserTicketOpen","queueTicketOpen","setQueueTicketOpen","selectedContact","setContact","id","name","number","profilePicUrl","delayDebounceFn","setTimeout","fetchContacts","replace","getData","get","concat","data","contactId","obj","urlPicture","contactObj","email","post","err","console","log","clearTimeout","handleCloseAlert","handleNewChat","ticket","userId","status","push","uuid","JSON","parse","response","error","queue","createElement","Fragment","style","minWidth","isOpen","handleClose","container","spacing","item","xs","src","marginTop","marginLeft","color","variant","gutterBottom","fullWidth","onClick","disabled"],"sources":["C:/ProjectsCode/ZapRun/ZapRun/frontend/src/components/VcardPreview/index.js"],"sourcesContent":["import React, { useEffect, useState, useContext } from 'react';\nimport { useHistory } from \"react-router-dom\";\nimport toastError from \"../../errors/toastError\";\nimport api from \"../../services/api\";\n\nimport Avatar from \"@material-ui/core/Avatar\";\nimport Typography from \"@material-ui/core/Typography\";\nimport Grid from \"@material-ui/core/Grid\";\n\nimport { AuthContext } from \"../../context/Auth/AuthContext\";\n\nimport { Button, Divider, useTheme, } from \"@material-ui/core\";\nimport { isNil } from 'lodash';\nimport ShowTicketOpen from '../ShowTicketOpenModal';\nimport { grey } from '@material-ui/core/colors';\n\nconst VcardPreview = ({ contact, numbers, queueId, whatsappId }) => {\n    const theme = useTheme();\n    const history = useHistory();\n    const { user } = useContext(AuthContext);\n\n    const companyId = user.companyId;\n\n    const [openAlert, setOpenAlert] = useState(false);\n    const [userTicketOpen, setUserTicketOpen] = useState(\"\");\n    const [queueTicketOpen, setQueueTicketOpen] = useState(\"\");\n\n    const [selectedContact, setContact] = useState({\n        id: 0,\n        name: \"\",\n        number: 0,\n        profilePicUrl: \"\"\n    });\n    useEffect(() => {\n        const delayDebounceFn = setTimeout(() => {\n            const fetchContacts = async () => {\n                try {\n                    if (isNil(numbers)) {\n                        return\n                    }\n                    const number = numbers.replace(/\\D/g, \"\");\n                    \n                    const getData = await api.get(`/contacts/profile/${number}`);\n\n                    if (getData.data.contactId && getData.data.contactId !== 0) {\n                        let obj = {\n                            id: getData.data.contactId,\n                            name: contact,\n                            number: numbers,\n                            profilePicUrl: getData.data.urlPicture\n                        }\n\n                        setContact(obj)\n                  \n                    } else {\n                        let contactObj = {\n                            name: contact,\n                            number: number,\n                            email: \"\",\n                            companyId: companyId\n                        }\n\n                        const { data } = await api.post(\"/contacts\", contactObj);\n                        setContact(data)\n                    }\n            \n                } catch (err) {\n                    console.log(err)\n                    toastError(err);\n                }\n            };\n            fetchContacts();\n        }, 500);\n        return () => clearTimeout(delayDebounceFn);\n    }, [companyId, contact, numbers]);\n\n    const handleCloseAlert = () => {\n        setOpenAlert(false);\n        setOpenAlert(false);\n        setUserTicketOpen(\"\");\n        setQueueTicketOpen(\"\");\n    };\n\n    const handleNewChat = async () => {\n        try {\n            const { data: ticket } = await api.post(\"/tickets\", {\n                contactId: selectedContact.id,\n                userId: user.id,\n                status: \"open\",\n                queueId,\n                companyId: companyId,\n                whatsappId\n            });\n\n            history.push(`/tickets/${ticket.uuid}`);\n        } catch (err) {\n            const ticket = JSON.parse(err.response.data.error);\n\n            if (ticket.userId !== user?.id) {\n                setOpenAlert(true);\n                setUserTicketOpen(ticket.user.name);\n                setQueueTicketOpen(ticket.queue.name);\n            } else {\n                setOpenAlert(false);\n                setUserTicketOpen(\"\");\n                setQueueTicketOpen(\"\");\n\n                history.push(`/tickets/${ticket.uuid}`);\n            }\n        }\n    }\n\n    return (\n        <>\n            <div style={{\n                minWidth: \"250px\",\n            }}>\n                <ShowTicketOpen\n                    isOpen={openAlert}\n                    handleClose={handleCloseAlert}\n                    user={userTicketOpen}\n                    queue={queueTicketOpen}\n                />\n                <Grid container spacing={1}>\n                    <Grid item xs={2}>\n                        <Avatar src={`${selectedContact?.urlPicture}`} />\n                    </Grid>\n                    <Grid item xs={9}>\n                        <Typography\n                            style={{ marginTop: \"12px\", marginLeft: \"10px\" }}\n                            color=\"primary\"\n                            variant=\"subtitle1\"\n                            gutterBottom\n                        >\n                            {selectedContact.name}\n                        </Typography>\n                    </Grid>\n                    <Grid item xs={12}>\n                        <Divider />\n                        <Button\n                            fullWidth\n                            color=\"primary\"\n                            onClick={handleNewChat}\n                            disabled={!selectedContact.number}\n                        >Conversar</Button>\n                    </Grid>\n                </Grid>\n            </div>\n        </>\n    );\n\n};\n\nexport default VcardPreview;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}