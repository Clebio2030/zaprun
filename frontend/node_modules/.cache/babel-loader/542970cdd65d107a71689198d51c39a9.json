{"ast":null,"code":"import React,{useContext,useState}from\"react\";import{Chip,IconButton,List,ListItem,ListItemSecondaryAction,ListItemText,makeStyles}from\"@material-ui/core\";import{useHistory,useParams}from\"react-router-dom\";import{AuthContext}from\"../../context/Auth/AuthContext\";import{useDate}from\"../../hooks/useDate\";import DeleteIcon from\"@material-ui/icons/Delete\";import EditIcon from\"@material-ui/icons/Edit\";import ConfirmationModal from\"../../components/ConfirmationModal\";import api from\"../../services/api\";const useStyles=makeStyles(theme=>({mainContainer:{display:\"flex\",flexDirection:\"column\",position:\"relative\",flex:1,height:\"calc(100% - 58px)\",overflow:\"hidden\",borderRadius:0,backgroundColor:theme.mode==='light'?\"#f2f2f2\":\"#7f7f7f\"},chatList:{display:\"flex\",flexDirection:\"column\",position:\"relative\",flex:1,overflowY:\"scroll\",...theme.scrollbarStyles},listItemActive:{cursor:\"pointer\",backgroundColor:theme.palette.background.paper,borderLeft:\"6px solid #002d6e\"},listItem:{cursor:\"pointer\",backgroundColor:theme.palette.background.color}}));export default function ChatList(_ref){let{chats,handleSelectChat,handleDeleteChat,handleEditChat,pageInfo,loading}=_ref;const classes=useStyles();const history=useHistory();const{user,socket}=useContext(AuthContext);const{datetimeToClient}=useDate();const[confirmationModal,setConfirmModalOpen]=useState(false);const[selectedChat,setSelectedChat]=useState({});const{id}=useParams();const goToMessages=async chat=>{if(unreadMessages(chat)>0){try{await api.post(\"/chats/\".concat(chat.id,\"/read\"),{userId:user.id});}catch(err){}}if(id!==chat.uuid){history.push(\"/chats/\".concat(chat.uuid));handleSelectChat(chat);}};const handleDelete=()=>{handleDeleteChat(selectedChat);};const unreadMessages=chat=>{const currentUser=chat.users.find(u=>u.userId===user.id);return currentUser.unreads;};const getPrimaryText=chat=>{const mainText=chat.title;const unreads=unreadMessages(chat);return/*#__PURE__*/React.createElement(React.Fragment,null,mainText,unreads>0&&/*#__PURE__*/React.createElement(Chip,{size:\"small\",style:{marginLeft:5},label:unreads,color:\"secondary\"}));};const getSecondaryText=chat=>{return chat.lastMessage!==\"\"?\"\".concat(datetimeToClient(chat.updatedAt),\": \").concat(chat.lastMessage):\"\";};return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(ConfirmationModal,{title:\"Excluir Conversa\",open:confirmationModal,onClose:setConfirmModalOpen,onConfirm:handleDelete},\"Esta a\\xE7\\xE3o n\\xE3o pode ser revertida, confirmar?\"),/*#__PURE__*/React.createElement(\"div\",{className:classes.mainContainer},/*#__PURE__*/React.createElement(\"div\",{className:classes.chatList},/*#__PURE__*/React.createElement(List,null,Array.isArray(chats)&&chats.length>0&&chats.map((chat,key)=>/*#__PURE__*/React.createElement(ListItem,{onClick:()=>goToMessages(chat),key:key,className:chat.uuid===id?classes.listItemActive:classes.listItem// style={getItemStyle(chat)}\n,button:true},/*#__PURE__*/React.createElement(ListItemText,{primary:getPrimaryText(chat),secondary:getSecondaryText(chat)}),chat.ownerId===user.id&&/*#__PURE__*/React.createElement(ListItemSecondaryAction,null,/*#__PURE__*/React.createElement(IconButton,{onClick:()=>{goToMessages(chat).then(()=>{handleEditChat(chat);});},edge:\"end\",\"aria-label\":\"delete\",size:\"small\",style:{marginRight:5}},/*#__PURE__*/React.createElement(EditIcon,null)),/*#__PURE__*/React.createElement(IconButton,{onClick:()=>{setSelectedChat(chat);setConfirmModalOpen(true);},edge:\"end\",\"aria-label\":\"delete\",size:\"small\"},/*#__PURE__*/React.createElement(DeleteIcon,null)))))))));}","map":{"version":3,"names":["React","useContext","useState","Chip","IconButton","List","ListItem","ListItemSecondaryAction","ListItemText","makeStyles","useHistory","useParams","AuthContext","useDate","DeleteIcon","EditIcon","ConfirmationModal","api","useStyles","theme","mainContainer","display","flexDirection","position","flex","height","overflow","borderRadius","backgroundColor","mode","chatList","overflowY","scrollbarStyles","listItemActive","cursor","palette","background","paper","borderLeft","listItem","color","ChatList","_ref","chats","handleSelectChat","handleDeleteChat","handleEditChat","pageInfo","loading","classes","history","user","socket","datetimeToClient","confirmationModal","setConfirmModalOpen","selectedChat","setSelectedChat","id","goToMessages","chat","unreadMessages","post","concat","userId","err","uuid","push","handleDelete","currentUser","users","find","u","unreads","getPrimaryText","mainText","title","createElement","Fragment","size","style","marginLeft","label","getSecondaryText","lastMessage","updatedAt","open","onClose","onConfirm","className","Array","isArray","length","map","key","onClick","button","primary","secondary","ownerId","then","edge","marginRight"],"sources":["C:/ProjectsCode/ZapRun/ZapRun/frontend/src/pages/Chat/ChatList.js"],"sourcesContent":["import React, { useContext, useState } from \"react\";\r\nimport {\r\n  Chip,\r\n  IconButton,\r\n  List,\r\n  ListItem,\r\n  ListItemSecondaryAction,\r\n  ListItemText,\r\n  makeStyles,\r\n} from \"@material-ui/core\";\r\n\r\nimport { useHistory, useParams } from \"react-router-dom\";\r\nimport { AuthContext } from \"../../context/Auth/AuthContext\";\r\nimport { useDate } from \"../../hooks/useDate\";\r\n\r\nimport DeleteIcon from \"@material-ui/icons/Delete\";\r\nimport EditIcon from \"@material-ui/icons/Edit\";\r\n\r\nimport ConfirmationModal from \"../../components/ConfirmationModal\";\r\nimport api from \"../../services/api\";\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  mainContainer: {\r\n    display: \"flex\",\r\n    flexDirection: \"column\",\r\n    position: \"relative\",\r\n    flex: 1,\r\n    height: \"calc(100% - 58px)\",\r\n    overflow: \"hidden\",\r\n    borderRadius: 0,\r\n    backgroundColor: theme.mode === 'light' ? \"#f2f2f2\" : \"#7f7f7f\",\r\n  },\r\n  chatList: {\r\n    display: \"flex\",\r\n    flexDirection: \"column\",\r\n    position: \"relative\",\r\n    flex: 1,\r\n    overflowY: \"scroll\",\r\n    ...theme.scrollbarStyles,\r\n  },\r\n  listItemActive: {\r\n    cursor: \"pointer\",\r\n    backgroundColor: theme.palette.background.paper,\r\n    borderLeft: \"6px solid #002d6e\",\r\n  },\r\n  listItem: {\r\n    cursor: \"pointer\",\r\n    backgroundColor: theme.palette.background.color,\r\n  },\r\n}));\r\n\r\nexport default function ChatList({\r\n  chats,\r\n  handleSelectChat,\r\n  handleDeleteChat,\r\n  handleEditChat,\r\n  pageInfo,\r\n  loading,\r\n}) {\r\n  const classes = useStyles();\r\n  const history = useHistory();\r\n  const { user, socket } = useContext(AuthContext);\r\n  const { datetimeToClient } = useDate();\r\n\r\n  const [confirmationModal, setConfirmModalOpen] = useState(false);\r\n  const [selectedChat, setSelectedChat] = useState({});\r\n\r\n  const { id } = useParams();\r\n\r\n  const goToMessages = async (chat) => {\r\n    if (unreadMessages(chat) > 0) {\r\n      try {\r\n        await api.post(`/chats/${chat.id}/read`, { userId: user.id });\r\n      } catch (err) {}\r\n    }\r\n\r\n    if (id !== chat.uuid) {\r\n      history.push(`/chats/${chat.uuid}`);\r\n      handleSelectChat(chat);\r\n    }\r\n  };\r\n\r\n  const handleDelete = () => {\r\n    handleDeleteChat(selectedChat);\r\n  };\r\n\r\n  const unreadMessages = (chat) => {\r\n    const currentUser = chat.users.find((u) => u.userId === user.id);\r\n    return currentUser.unreads;\r\n  };\r\n\r\n  const getPrimaryText = (chat) => {\r\n    const mainText = chat.title;\r\n    const unreads = unreadMessages(chat);\r\n    return (\r\n      <>\r\n        {mainText}\r\n        {unreads > 0 && (\r\n          <Chip\r\n            size=\"small\"\r\n            style={{ marginLeft: 5 }}\r\n            label={unreads}\r\n            color=\"secondary\"\r\n          />\r\n        )}\r\n      </>\r\n    );\r\n  };\r\n\r\n  const getSecondaryText = (chat) => {\r\n    return chat.lastMessage !== \"\"\r\n      ? `${datetimeToClient(chat.updatedAt)}: ${chat.lastMessage}`\r\n      : \"\";\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <ConfirmationModal\r\n        title={\"Excluir Conversa\"}\r\n        open={confirmationModal}\r\n        onClose={setConfirmModalOpen}\r\n        onConfirm={handleDelete}\r\n      >\r\n        Esta ação não pode ser revertida, confirmar?\r\n      </ConfirmationModal>\r\n      <div className={classes.mainContainer}>\r\n        <div className={classes.chatList}>\r\n          <List>\r\n            {Array.isArray(chats) &&\r\n              chats.length > 0 &&\r\n              chats.map((chat, key) => (\r\n                <ListItem\r\n                  onClick={() => goToMessages(chat)}\r\n                  key={key}\r\n                  className={chat.uuid === id ? classes.listItemActive : classes.listItem}\r\n                  // style={getItemStyle(chat)}\r\n                  button\r\n                >\r\n                  <ListItemText\r\n                    primary={getPrimaryText(chat)}\r\n                    secondary={getSecondaryText(chat)}\r\n                  />\r\n                  {chat.ownerId === user.id && (\r\n                    <ListItemSecondaryAction>\r\n                      <IconButton\r\n                        onClick={() => {\r\n                          goToMessages(chat).then(() => {\r\n                            handleEditChat(chat);\r\n                          });\r\n                        }}\r\n                        edge=\"end\"\r\n                        aria-label=\"delete\"\r\n                        size=\"small\"\r\n                        style={{ marginRight: 5 }}\r\n                      >\r\n                        <EditIcon />\r\n                      </IconButton>\r\n                      <IconButton\r\n                        onClick={() => {\r\n                          setSelectedChat(chat);\r\n                          setConfirmModalOpen(true);\r\n                        }}\r\n                        edge=\"end\"\r\n                        aria-label=\"delete\"\r\n                        size=\"small\"\r\n                      >\r\n                        <DeleteIcon />\r\n                      </IconButton>\r\n                    </ListItemSecondaryAction>\r\n                  )}\r\n                </ListItem>\r\n              ))}\r\n          </List>\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}