{"ast":null,"code":"import React,{useContext,useEffect,useRef,useState}from\"react\";import{Box,FormControl,IconButton,Input,InputAdornment,makeStyles,Paper,Typography}from\"@material-ui/core\";import SendIcon from\"@material-ui/icons/Send\";import{AuthContext}from\"../../context/Auth/AuthContext\";import{useDate}from\"../../hooks/useDate\";import api from\"../../services/api\";const useStyles=makeStyles(theme=>({mainContainer:{display:\"flex\",flexDirection:\"column\",position:\"relative\",flex:1,overflow:\"hidden\",borderRadius:0,height:\"100%\",borderLeft:\"1px solid rgba(0, 0, 0, 0.12)\"},messageList:{position:\"relative\",overflowY:\"auto\",height:\"100%\",...theme.scrollbarStyles,backgroundColor:theme.mode==='light'?\"#f2f2f2\":\"#7f7f7f\"},inputArea:{position:\"relative\",height:\"auto\"},input:{padding:\"20px\"},buttonSend:{margin:theme.spacing(1)},boxLeft:{padding:\"10px 10px 5px\",margin:\"10px\",position:\"relative\",backgroundColor:\"#ffffff\",color:\"#303030\",maxWidth:300,borderRadius:10,borderBottomLeftRadius:0,border:\"1px solid rgba(0, 0, 0, 0.12)\"},boxRight:{padding:\"10px 10px 5px\",margin:\"10px 10px 10px auto\",position:\"relative\",backgroundColor:\"#dcf8c6\",color:\"#303030\",textAlign:\"right\",maxWidth:300,borderRadius:10,borderBottomRightRadius:0,border:\"1px solid rgba(0, 0, 0, 0.12)\"}}));export default function ChatMessages(_ref){let{chat,messages,handleSendMessage,handleLoadMore,scrollToBottomRef,pageInfo,loading}=_ref;const classes=useStyles();const{user,socket}=useContext(AuthContext);const{datetimeToClient}=useDate();const baseRef=useRef();const[contentMessage,setContentMessage]=useState(\"\");const scrollToBottom=()=>{if(baseRef.current){baseRef.current.scrollIntoView({});}};const unreadMessages=chat=>{if(chat!==undefined){const currentUser=chat.users.find(u=>u.userId===user.id);return currentUser.unreads>0;}return 0;};useEffect(()=>{if(unreadMessages(chat)>0){try{api.post(\"/chats/\".concat(chat.id,\"/read\"),{userId:user.id});}catch(err){}}scrollToBottomRef.current=scrollToBottom;// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);const handleScroll=e=>{const{scrollTop}=e.currentTarget;if(!pageInfo.hasMore||loading)return;if(scrollTop<600){handleLoadMore();}};return/*#__PURE__*/React.createElement(Paper,{className:classes.mainContainer},/*#__PURE__*/React.createElement(\"div\",{onScroll:handleScroll,className:classes.messageList},Array.isArray(messages)&&messages.map((item,key)=>{if(item.senderId===user.id){return/*#__PURE__*/React.createElement(Box,{key:key,className:classes.boxRight},/*#__PURE__*/React.createElement(Typography,{variant:\"subtitle2\"},item.sender.name),item.message,/*#__PURE__*/React.createElement(Typography,{variant:\"caption\",display:\"block\"},datetimeToClient(item.createdAt)));}else{return/*#__PURE__*/React.createElement(Box,{key:key,className:classes.boxLeft},/*#__PURE__*/React.createElement(Typography,{variant:\"subtitle2\"},item.sender.name),item.message,/*#__PURE__*/React.createElement(Typography,{variant:\"caption\",display:\"block\"},datetimeToClient(item.createdAt)));}}),/*#__PURE__*/React.createElement(\"div\",{ref:baseRef})),/*#__PURE__*/React.createElement(\"div\",{className:classes.inputArea},/*#__PURE__*/React.createElement(FormControl,{variant:\"outlined\",fullWidth:true},/*#__PURE__*/React.createElement(Input,{multiline:true,value:contentMessage,onKeyUp:e=>{if(e.key===\"Enter\"&&contentMessage.trim()!==\"\"){handleSendMessage(contentMessage);setContentMessage(\"\");}},onChange:e=>setContentMessage(e.target.value),className:classes.input,endAdornment:/*#__PURE__*/React.createElement(InputAdornment,{position:\"end\"},/*#__PURE__*/React.createElement(IconButton,{onClick:()=>{if(contentMessage.trim()!==\"\"){handleSendMessage(contentMessage);setContentMessage(\"\");}},className:classes.buttonSend},/*#__PURE__*/React.createElement(SendIcon,null)))}))));}","map":{"version":3,"names":["React","useContext","useEffect","useRef","useState","Box","FormControl","IconButton","Input","InputAdornment","makeStyles","Paper","Typography","SendIcon","AuthContext","useDate","api","useStyles","theme","mainContainer","display","flexDirection","position","flex","overflow","borderRadius","height","borderLeft","messageList","overflowY","scrollbarStyles","backgroundColor","mode","inputArea","input","padding","buttonSend","margin","spacing","boxLeft","color","maxWidth","borderBottomLeftRadius","border","boxRight","textAlign","borderBottomRightRadius","ChatMessages","_ref","chat","messages","handleSendMessage","handleLoadMore","scrollToBottomRef","pageInfo","loading","classes","user","socket","datetimeToClient","baseRef","contentMessage","setContentMessage","scrollToBottom","current","scrollIntoView","unreadMessages","undefined","currentUser","users","find","u","userId","id","unreads","post","concat","err","handleScroll","e","scrollTop","currentTarget","hasMore","createElement","className","onScroll","Array","isArray","map","item","key","senderId","variant","sender","name","message","createdAt","ref","fullWidth","multiline","value","onKeyUp","trim","onChange","target","endAdornment","onClick"],"sources":["C:/ProjectsCode/ZapRun/ZapRun/frontend/src/pages/Chat/ChatMessages.js"],"sourcesContent":["import React, { useContext, useEffect, useRef, useState } from \"react\";\r\nimport {\r\n  Box,\r\n  FormControl,\r\n  IconButton,\r\n  Input,\r\n  InputAdornment,\r\n  makeStyles,\r\n  Paper,\r\n  Typography,\r\n} from \"@material-ui/core\";\r\nimport SendIcon from \"@material-ui/icons/Send\";\r\n\r\nimport { AuthContext } from \"../../context/Auth/AuthContext\";\r\nimport { useDate } from \"../../hooks/useDate\";\r\nimport api from \"../../services/api\";\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  mainContainer: {\r\n    display: \"flex\",\r\n    flexDirection: \"column\",\r\n    position: \"relative\",\r\n    flex: 1,\r\n    overflow: \"hidden\",\r\n    borderRadius: 0,\r\n    height: \"100%\",\r\n    borderLeft: \"1px solid rgba(0, 0, 0, 0.12)\",\r\n  },\r\n  messageList: {\r\n    position: \"relative\",\r\n    overflowY: \"auto\",\r\n    height: \"100%\",\r\n    ...theme.scrollbarStyles,\r\n    backgroundColor: theme.mode === 'light' ? \"#f2f2f2\" : \"#7f7f7f\",\r\n  },\r\n  inputArea: {\r\n    position: \"relative\",\r\n    height: \"auto\",\r\n  },\r\n  input: {\r\n    padding: \"20px\",\r\n  },\r\n  buttonSend: {\r\n    margin: theme.spacing(1),\r\n  },\r\n  boxLeft: {\r\n    padding: \"10px 10px 5px\",\r\n    margin: \"10px\",\r\n    position: \"relative\",\r\n    backgroundColor: \"#ffffff\",\r\n    color: \"#303030\",\r\n    maxWidth: 300,\r\n    borderRadius: 10,\r\n    borderBottomLeftRadius: 0,\r\n    border: \"1px solid rgba(0, 0, 0, 0.12)\",\r\n  },\r\n  boxRight: {\r\n    padding: \"10px 10px 5px\",\r\n    margin: \"10px 10px 10px auto\",\r\n    position: \"relative\",\r\n    backgroundColor: \"#dcf8c6\",\r\n    color: \"#303030\",\r\n    textAlign: \"right\",\r\n    maxWidth: 300,\r\n    borderRadius: 10,\r\n    borderBottomRightRadius: 0,\r\n    border: \"1px solid rgba(0, 0, 0, 0.12)\",\r\n  },\r\n}));\r\n\r\nexport default function ChatMessages({\r\n  chat,\r\n  messages,\r\n  handleSendMessage,\r\n  handleLoadMore,\r\n  scrollToBottomRef,\r\n  pageInfo,\r\n  loading,\r\n}) {\r\n  const classes = useStyles();\r\n  const { user, socket } = useContext(AuthContext);\r\n  const { datetimeToClient } = useDate();\r\n  const baseRef = useRef();\r\n\r\n  const [contentMessage, setContentMessage] = useState(\"\");\r\n\r\n  const scrollToBottom = () => {\r\n    if (baseRef.current) {\r\n      baseRef.current.scrollIntoView({});\r\n    }\r\n  };\r\n\r\n  const unreadMessages = (chat) => {\r\n    if (chat !== undefined) {\r\n      const currentUser = chat.users.find((u) => u.userId === user.id);\r\n      return currentUser.unreads > 0;\r\n    }\r\n    return 0;\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (unreadMessages(chat) > 0) {\r\n      try {\r\n        api.post(`/chats/${chat.id}/read`, { userId: user.id });\r\n      } catch (err) {}\r\n    }\r\n    scrollToBottomRef.current = scrollToBottom;\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  const handleScroll = (e) => {\r\n    const { scrollTop } = e.currentTarget;\r\n    if (!pageInfo.hasMore || loading) return;\r\n    if (scrollTop < 600) {\r\n      handleLoadMore();\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Paper className={classes.mainContainer}>\r\n      <div onScroll={handleScroll} className={classes.messageList}>\r\n        {Array.isArray(messages) &&\r\n          messages.map((item, key) => {\r\n            if (item.senderId === user.id) {\r\n              return (\r\n                <Box key={key} className={classes.boxRight}>\r\n                  <Typography variant=\"subtitle2\">\r\n                    {item.sender.name}\r\n                  </Typography>\r\n                  {item.message}\r\n                  <Typography variant=\"caption\" display=\"block\">\r\n                    {datetimeToClient(item.createdAt)}\r\n                  </Typography>\r\n                </Box>\r\n              );\r\n            } else {\r\n              return (\r\n                <Box key={key} className={classes.boxLeft}>\r\n                  <Typography variant=\"subtitle2\">\r\n                    {item.sender.name}\r\n                  </Typography>\r\n                  {item.message}\r\n                  <Typography variant=\"caption\" display=\"block\">\r\n                    {datetimeToClient(item.createdAt)}\r\n                  </Typography>\r\n                </Box>\r\n              );\r\n            }\r\n          })}\r\n        <div ref={baseRef}></div>\r\n      </div>\r\n      <div className={classes.inputArea}>\r\n        <FormControl variant=\"outlined\" fullWidth>\r\n          <Input\r\n            multiline\r\n            value={contentMessage}\r\n            onKeyUp={(e) => {\r\n              if (e.key === \"Enter\" && contentMessage.trim() !== \"\") {\r\n                handleSendMessage(contentMessage);\r\n                setContentMessage(\"\");\r\n              }\r\n            }}\r\n            onChange={(e) => setContentMessage(e.target.value)}\r\n            className={classes.input}\r\n            endAdornment={\r\n              <InputAdornment position=\"end\">\r\n                <IconButton\r\n                  onClick={() => {\r\n                    if (contentMessage.trim() !== \"\") {\r\n                      handleSendMessage(contentMessage);\r\n                      setContentMessage(\"\");\r\n                    }\r\n                  }}\r\n                  className={classes.buttonSend}\r\n                >\r\n                  <SendIcon />\r\n                </IconButton>\r\n              </InputAdornment>\r\n            }\r\n          />\r\n        </FormControl>\r\n      </div>\r\n    </Paper>\r\n  );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}