{"ast":null,"code":"import React,{useEffect,useState,useContext}from\"react\";import QRCode from\"qrcode.react\";import toastError from\"../../errors/toastError\";import{makeStyles}from\"@material-ui/core/styles\";import{Dialog,DialogContent,Paper,Typography}from\"@material-ui/core\";import{i18n}from\"../../translate/i18n\";import api from\"../../services/api\";import{AuthContext}from\"../../context/Auth/AuthContext\";const useStyles=makeStyles(theme=>({root:{display:\"flex\",flexWrap:\"wrap\"}}));const QrcodeModal=_ref=>{let{open,onClose,whatsAppId}=_ref;const classes=useStyles();const[qrCode,setQrCode]=useState(\"\");const{user,socket}=useContext(AuthContext);useEffect(()=>{const fetchSession=async()=>{if(!whatsAppId)return;try{const{data}=await api.get(\"/whatsapp/\".concat(whatsAppId));setQrCode(data.qrcode);}catch(err){toastError(err);}};fetchSession();},[whatsAppId]);useEffect(()=>{if(!whatsAppId)return;const companyId=user.companyId;// const socket = socketConnection({ companyId, userId: user.id });\nconst onWhatsappData=data=>{if(data.action===\"update\"&&data.session.id===whatsAppId){setQrCode(data.session.qrcode);}if(data.action===\"update\"&&data.session.qrcode===\"\"){onClose();}};socket.on(\"company-\".concat(companyId,\"-whatsappSession\"),onWhatsappData);return()=>{socket.off(\"company-\".concat(companyId,\"-whatsappSession\"),onWhatsappData);};},[whatsAppId,onClose]);return/*#__PURE__*/React.createElement(Dialog,{open:open,onClose:onClose,maxWidth:\"lg\",scroll:\"paper\"},/*#__PURE__*/React.createElement(DialogContent,null,/*#__PURE__*/React.createElement(Paper,{elevation:0},/*#__PURE__*/React.createElement(Typography,{color:\"secondary\",gutterBottom:true},i18n.t(\"qrCode.message\")),/*#__PURE__*/React.createElement(\"div\",{className:classes.root},qrCode?/*#__PURE__*/React.createElement(QRCode,{value:qrCode,size:300,style:{backgroundColor:\"white\",padding:'5px'}}):/*#__PURE__*/React.createElement(\"span\",null,\"Aguardando pelo QR Code\")))));};export default React.memo(QrcodeModal);","map":{"version":3,"names":["React","useEffect","useState","useContext","QRCode","toastError","makeStyles","Dialog","DialogContent","Paper","Typography","i18n","api","AuthContext","useStyles","theme","root","display","flexWrap","QrcodeModal","_ref","open","onClose","whatsAppId","classes","qrCode","setQrCode","user","socket","fetchSession","data","get","concat","qrcode","err","companyId","onWhatsappData","action","session","id","on","off","createElement","maxWidth","scroll","elevation","color","gutterBottom","t","className","value","size","style","backgroundColor","padding","memo"],"sources":["C:/ProjectsCode/ZapRun/ZapRun/frontend/src/components/QrcodeModal/index.js"],"sourcesContent":["import React, { useEffect, useState, useContext } from \"react\";\nimport QRCode from \"qrcode.react\";\nimport toastError from \"../../errors/toastError\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { Dialog, DialogContent, Paper, Typography } from \"@material-ui/core\";\nimport { i18n } from \"../../translate/i18n\";\nimport api from \"../../services/api\";\n\nimport { AuthContext } from \"../../context/Auth/AuthContext\";\n\nconst useStyles = makeStyles((theme) => ({\n  root: {\n    display: \"flex\",\n    flexWrap: \"wrap\",\n  },\n}))\n\nconst QrcodeModal = ({ open, onClose, whatsAppId }) => {\n  const classes = useStyles();\n  const [qrCode, setQrCode] = useState(\"\");\n  const { user, socket } = useContext(AuthContext);\n\n  useEffect(() => {\n    const fetchSession = async () => {\n      if (!whatsAppId) return;\n\n      try {\n        const { data } = await api.get(`/whatsapp/${whatsAppId}`);\n        setQrCode(data.qrcode);\n      } catch (err) {\n        toastError(err);\n      }\n    };\n    fetchSession();\n  }, [whatsAppId]);\n\n  useEffect(() => {\n    if (!whatsAppId) return;\n    const companyId = user.companyId;\n    // const socket = socketConnection({ companyId, userId: user.id });\n\n    const onWhatsappData = (data) => {\n      if (data.action === \"update\" && data.session.id === whatsAppId) {\n        setQrCode(data.session.qrcode);\n      }\n\n      if (data.action === \"update\" && data.session.qrcode === \"\") {\n        onClose();\n      }\n    }\n    socket.on(`company-${companyId}-whatsappSession`, onWhatsappData);\n\n    return () => {\n      socket.off(`company-${companyId}-whatsappSession`, onWhatsappData);\n    };\n  }, [whatsAppId, onClose]);\n\n  return (\n    <Dialog open={open} onClose={onClose} maxWidth=\"lg\" scroll=\"paper\">\n      <DialogContent>\n        <Paper elevation={0}>\n          <Typography color=\"secondary\" gutterBottom>\n            {i18n.t(\"qrCode.message\")}\n          </Typography>\n          <div className={classes.root}>\n            {qrCode ? (\n              <QRCode value={qrCode} size={300} style={{ backgroundColor: \"white\", padding: '5px' }} />\n            ) : (\n              <span>Aguardando pelo QR Code</span>\n            )}\n          </div>\n        </Paper>\n      </DialogContent>\n    </Dialog>\n  );\n};\n\nexport default React.memo(QrcodeModal);\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}