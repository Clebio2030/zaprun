{"ast":null,"code":"import{useState,useEffect,useReducer,useContext}from\"react\";import toastError from\"../../errors/toastError\";import api from\"../../services/api\";// import { SocketContext } from \"../../context/Socket/SocketContext\";\nimport{AuthContext}from\"../../context/Auth/AuthContext\";import{isNill}from\"lodash\";const reducer=(state,action)=>{if(action.type===\"LOAD_WHATSAPPS\"){const whatsApps=action.payload;return[...whatsApps];}if(action.type===\"UPDATE_WHATSAPPS\"){const whatsApp=action.payload;const whatsAppIndex=state.findIndex(s=>s.id===whatsApp.id);if(whatsAppIndex!==-1){state[whatsAppIndex]=whatsApp;return[...state];}else{return[whatsApp,...state];}}if(action.type===\"UPDATE_SESSION\"){const whatsApp=action.payload;const whatsAppIndex=state.findIndex(s=>s.id===whatsApp.id);if(whatsAppIndex!==-1){state[whatsAppIndex].status=whatsApp.status;state[whatsAppIndex].updatedAt=whatsApp.updatedAt;state[whatsAppIndex].qrcode=whatsApp.qrcode;state[whatsAppIndex].retries=whatsApp.retries;return[...state];}else{return[...state];}}if(action.type===\"DELETE_WHATSAPPS\"){const whatsAppId=action.payload;const whatsAppIndex=state.findIndex(s=>s.id===whatsAppId);if(whatsAppIndex!==-1){state.splice(whatsAppIndex,1);}return[...state];}if(action.type===\"RESET\"){return[];}};const useWhatsApps=()=>{const[whatsApps,dispatch]=useReducer(reducer,[]);const[loading,setLoading]=useState(true);//   const socketManager = useContext(SocketContext);\nconst{user,socket}=useContext(AuthContext);useEffect(()=>{setLoading(true);const fetchSession=async()=>{try{const{data}=await api.get(\"/whatsapp/?session=0\");dispatch({type:\"LOAD_WHATSAPPS\",payload:data});setLoading(false);}catch(_){setLoading(false);// toastError(err);\n}};fetchSession();},[]);useEffect(()=>{if(user.companyId){const companyId=user.companyId;//    const socket = socketManager.GetSocket();\nconst onCompanyWhatsapp=data=>{if(data.action===\"update\"){dispatch({type:\"UPDATE_WHATSAPPS\",payload:data.whatsapp});}if(data.action===\"delete\"){dispatch({type:\"DELETE_WHATSAPPS\",payload:data.whatsappId});}};const onCompanyWhatsappSession=data=>{if(data.action===\"update\"){dispatch({type:\"UPDATE_SESSION\",payload:data.session});}};socket.on(\"company-\".concat(companyId,\"-whatsapp\"),onCompanyWhatsapp);socket.on(\"company-\".concat(companyId,\"-whatsappSession\"),onCompanyWhatsappSession);return()=>{socket.off(\"company-\".concat(companyId,\"-whatsapp\"),onCompanyWhatsapp);socket.off(\"company-\".concat(companyId,\"-whatsappSession\"),onCompanyWhatsappSession);};}},[socket]);return{whatsApps,loading};};export default useWhatsApps;","map":{"version":3,"names":["useState","useEffect","useReducer","useContext","toastError","api","AuthContext","isNill","reducer","state","action","type","whatsApps","payload","whatsApp","whatsAppIndex","findIndex","s","id","status","updatedAt","qrcode","retries","whatsAppId","splice","useWhatsApps","dispatch","loading","setLoading","user","socket","fetchSession","data","get","_","companyId","onCompanyWhatsapp","whatsapp","whatsappId","onCompanyWhatsappSession","session","on","concat","off"],"sources":["C:/ProjectsCode/ZapRun/ZapRun/frontend/src/hooks/useWhatsApps/index.js"],"sourcesContent":["import { useState, useEffect, useReducer, useContext } from \"react\";\r\nimport toastError from \"../../errors/toastError\";\r\n\r\nimport api from \"../../services/api\";\r\n// import { SocketContext } from \"../../context/Socket/SocketContext\";\r\nimport { AuthContext } from \"../../context/Auth/AuthContext\";\r\nimport { isNill } from \"lodash\";\r\n\r\nconst reducer = (state, action) => {\r\n  if (action.type === \"LOAD_WHATSAPPS\") {\r\n    const whatsApps = action.payload;\r\n\r\n    return [...whatsApps];\r\n  }\r\n\r\n  if (action.type === \"UPDATE_WHATSAPPS\") {\r\n    const whatsApp = action.payload;\r\n    const whatsAppIndex = state.findIndex((s) => s.id === whatsApp.id);\r\n\r\n    if (whatsAppIndex !== -1) {\r\n      state[whatsAppIndex] = whatsApp;\r\n      return [...state];\r\n    } else {\r\n      return [whatsApp, ...state];\r\n    }\r\n  }\r\n\r\n  if (action.type === \"UPDATE_SESSION\") {\r\n    const whatsApp = action.payload;\r\n    const whatsAppIndex = state.findIndex((s) => s.id === whatsApp.id);\r\n\r\n    if (whatsAppIndex !== -1) {\r\n      state[whatsAppIndex].status = whatsApp.status;\r\n      state[whatsAppIndex].updatedAt = whatsApp.updatedAt;\r\n      state[whatsAppIndex].qrcode = whatsApp.qrcode;\r\n      state[whatsAppIndex].retries = whatsApp.retries;\r\n      return [...state];\r\n    } else {\r\n      return [...state];\r\n    }\r\n  }\r\n\r\n  if (action.type === \"DELETE_WHATSAPPS\") {\r\n    const whatsAppId = action.payload;\r\n\r\n    const whatsAppIndex = state.findIndex((s) => s.id === whatsAppId);\r\n    if (whatsAppIndex !== -1) {\r\n      state.splice(whatsAppIndex, 1);\r\n    }\r\n    return [...state];\r\n  }\r\n\r\n  if (action.type === \"RESET\") {\r\n    return [];\r\n  }\r\n};\r\n\r\nconst useWhatsApps = () => {\r\n  const [whatsApps, dispatch] = useReducer(reducer, []);\r\n  const [loading, setLoading] = useState(true);\r\n//   const socketManager = useContext(SocketContext);\r\n  const { user, socket } = useContext(AuthContext);\r\n\r\n\r\n\r\n  useEffect(() => {\r\n    setLoading(true);\r\n    const fetchSession = async () => {\r\n      try {\r\n        const { data } = await api.get(\"/whatsapp/?session=0\");\r\n        dispatch({ type: \"LOAD_WHATSAPPS\", payload: data });\r\n        setLoading(false);\r\n      } catch (_) {\r\n        setLoading(false);\r\n        // toastError(err);\r\n      }\r\n    };\r\n    fetchSession();\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (user.companyId) {\r\n\r\n      const companyId = user.companyId;\r\n//    const socket = socketManager.GetSocket();\r\n\r\n      const onCompanyWhatsapp = (data) => {\r\n        if (data.action === \"update\") {\r\n          dispatch({ type: \"UPDATE_WHATSAPPS\", payload: data.whatsapp });\r\n        }\r\n        if (data.action === \"delete\") {\r\n          dispatch({ type: \"DELETE_WHATSAPPS\", payload: data.whatsappId });\r\n        }\r\n      }\r\n\r\n      const onCompanyWhatsappSession = (data) => {\r\n        if (data.action === \"update\") {\r\n          dispatch({ type: \"UPDATE_SESSION\", payload: data.session });\r\n        }\r\n      }\r\n\r\n      socket.on(`company-${companyId}-whatsapp`, onCompanyWhatsapp);\r\n      socket.on(`company-${companyId}-whatsappSession`, onCompanyWhatsappSession);\r\n\r\n      return () => {\r\n        socket.off(`company-${companyId}-whatsapp`, onCompanyWhatsapp);\r\n        socket.off(`company-${companyId}-whatsappSession`, onCompanyWhatsappSession);\r\n      };\r\n    }\r\n  }, [socket]);\r\n\r\n  return { whatsApps, loading };\r\n};\r\n\r\nexport default useWhatsApps;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}